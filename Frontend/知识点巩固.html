<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端知识点 | 小栗子的知识库</title>
    <meta name="description" content="我的个人网站">
    
    
    <link rel="preload" href="/assets/css/0.styles.6aaa91c1.css" as="style"><link rel="preload" href="/assets/js/app.74c4e6cc.js" as="script"><link rel="preload" href="/assets/js/9.de46f015.js" as="script"><link rel="prefetch" href="/assets/js/10.2803122b.js"><link rel="prefetch" href="/assets/js/11.6fe180f8.js"><link rel="prefetch" href="/assets/js/12.045af6f4.js"><link rel="prefetch" href="/assets/js/13.829ba624.js"><link rel="prefetch" href="/assets/js/14.26e60d35.js"><link rel="prefetch" href="/assets/js/15.6ddb0ca7.js"><link rel="prefetch" href="/assets/js/16.b956b9f4.js"><link rel="prefetch" href="/assets/js/17.0966bb36.js"><link rel="prefetch" href="/assets/js/2.f3129223.js"><link rel="prefetch" href="/assets/js/3.a5e28c40.js"><link rel="prefetch" href="/assets/js/4.9d104acd.js"><link rel="prefetch" href="/assets/js/5.3b5235b7.js"><link rel="prefetch" href="/assets/js/6.32ca3a9e.js"><link rel="prefetch" href="/assets/js/7.678692eb.js"><link rel="prefetch" href="/assets/js/8.c6e0c3ad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6aaa91c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="小栗子的知识库" class="logo"> <span class="site-name can-hide">小栗子的知识库</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frontend/知识点巩固.html" class="nav-link">知识点巩固</a></li><li class="dropdown-item"><!----> <a href="/Frontend/金渡课程.html" class="nav-link">金渡课程</a></li><li class="dropdown-item"><!----> <a href="/Frontend/黑马课程.html" class="nav-link">黑马课程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/黑马课程.html" class="nav-link">黑马课程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端外部资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontStudy/千古壹号.html" class="nav-link">千古壹号</a></li><li class="dropdown-item"><!----> <a href="/FrontStudy/poetry.html" class="nav-link">poetry</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">代码管理工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frontutils/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Frontutils/SVN.html" class="nav-link">SVN</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Other learning</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/OtherLearning/python.html" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/git1582364788" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端学习</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frontend/知识点巩固.html" class="nav-link">知识点巩固</a></li><li class="dropdown-item"><!----> <a href="/Frontend/金渡课程.html" class="nav-link">金渡课程</a></li><li class="dropdown-item"><!----> <a href="/Frontend/黑马课程.html" class="nav-link">黑马课程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Node/黑马课程.html" class="nav-link">黑马课程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端外部资源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontStudy/千古壹号.html" class="nav-link">千古壹号</a></li><li class="dropdown-item"><!----> <a href="/FrontStudy/poetry.html" class="nav-link">poetry</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">代码管理工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frontutils/Git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/Frontutils/SVN.html" class="nav-link">SVN</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Other learning</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/OtherLearning/python.html" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/git1582364788" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Frontend/" aria-current="page" class="sidebar-link">前端学习</a></li><li><a href="/Frontend/知识点巩固.html" class="active sidebar-link">前端知识点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/知识点巩固.html#html" class="sidebar-link">Html</a></li><li class="sidebar-sub-header"><a href="/Frontend/知识点巩固.html#css" class="sidebar-link">Css</a></li><li class="sidebar-sub-header"><a href="/Frontend/知识点巩固.html#javascript" class="sidebar-link">Javascript</a></li><li class="sidebar-sub-header"><a href="/Frontend/知识点巩固.html#vue" class="sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/知识点巩固.html#_1-vue3为什么要用proxy替代object-defineproperty？" class="sidebar-link">1.vue3为什么要用Proxy替代Object.defineProperty？</a></li></ul></li></ul></li><li><a href="/Frontend/金渡课程.html" class="sidebar-link">金渡课程笔记</a></li><li><a href="/Frontend/黑马课程.html" class="sidebar-link">Vue</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="前端知识点"><a href="#前端知识点" class="header-anchor">#</a> 前端知识点</h1> <h2 id="html"><a href="#html" class="header-anchor">#</a> Html</h2> <h2 id="css"><a href="#css" class="header-anchor">#</a> Css</h2> <h2 id="javascript"><a href="#javascript" class="header-anchor">#</a> Javascript</h2> <h2 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h2> <h3 id="_1-vue3为什么要用proxy替代object-defineproperty？"><a href="#_1-vue3为什么要用proxy替代object-defineproperty？" class="header-anchor">#</a> 1.vue3为什么要用Proxy替代Object.defineProperty？</h3> <ul><li>Object.defineProperty为什么可以实现响应式？</li> <li>Object.defineProperty的劣势？</li> <li>Proxy为什么可以实现响应式？</li> <li>对比Object.defineProperty，Proxy的优势在哪？</li></ul> <p><strong>Vue2的响应式:</strong></p> <p>是通过Object.defineProperty()来拦截数据，将数据转换成getter/setter的形式，在访问数据时调用getter函数，在修改数据时调用setter函数。然后利用发布-订阅模式，在数据变动时触发依赖，也即发布更新给订阅者，订阅者收到消息后进行相应的处理。</p> <p>Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象</p> <div class="language- extra-class"><pre class="language-text"><code>let obj={}
Object.defineProperty(obj,&quot;name&quot;,{
    value:1,//给属性赋值
    writable:false,//是否可以赋值
    enumerable:false,//是否可以枚举，是否可以遍历
    configurable:false//是否可以删除
})
obj.name=&quot;123&quot;
// for(let key in obj){
//     console.log(key);
// }
delete obj.name
console.log(obj.name);
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>let obj = {};
let value = &quot;123&quot;;
Object.defineProperty(obj, &quot;name&quot;, {
  get: function () {
    //只要获取name属性，自动调用get方法
    return value;
  },
  set: function (newValue) {
    //只要设置name属性，自动调用set方法
    console.log(&quot;设置name&quot;);
    value=newValue
  },
});
// value=&quot;11111&quot;
obj.name = &quot;1111&quot;;
console.log(obj.name);
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// 监听数据
let obj = {
  name: &quot;张三&quot;,
  age: 18,
  job: {
    code: &quot;前端&quot;,
    a: {},
  },
};
// 封装监听数据变化的函数
function dProperty(obj, key, value) {
  // 如果存在嵌套对象的情况，通过递归解决
  observer(value);
  Object.defineProperty(obj, key, {
    get: function () {
      console.log(&quot;获取&quot;, key, &quot;成功&quot;);
      return value;
    },
    set: function (newValue) {
      if (newValue === value) return;
      //   如果给key赋值为一个对象的时候，需要通过递归处理
      observer(newValue);
      console.log(&quot;设置&quot;, key, &quot;属性成功&quot;);
      value = newValue;
      //   对应页面渲染
    },
  });
}
function observer(obj) {
  if (typeof obj !== &quot;object&quot; || obj == null) {
    return;
  }
  //   给对象每一个属性设置响应式
  for (let key in obj) {
    dProperty(obj, key, obj[key]);
  }
}
observer(obj);
// obj.name = &quot;李四&quot;;
// console.log(obj.age);
// obj.job.code = &quot;php&quot;;
// console.log(obj.job.code);
// obj.name = {
//   sname: &quot;小张&quot;,
// };
// obj.name.sname = &quot;小李&quot;;
// console.log(obj.name.sname);
obj.gender=&quot;男&quot;
console.log(obj.gender);
// 删除和添加都不能劫持 set delete
let arr=[1,2,3,4]
arr.forEach((item,index)=&gt;{
    dProperty(arr,index,item)
})
console.log(arr[0]);
arr.push(111)  //重写数组的api
console.log(arr);
</code></pre></div><p><strong>弊端：</strong></p> <ul><li>1、对对象的添加和删除操作，无法劫持到</li> <li>2、对数组的api无法劫持到</li> <li>3、存在深层嵌套关系，性能问题</li></ul> <p>ES6新增Proxy <a href="https://es6.ruanyifeng.com/" target="_blank" rel="noopener noreferrer">es6阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Vue3基于ES6新增的<strong>Proxy对象</strong>实现数据代理以及通过<strong>Reflect</strong>对源数据进行操作，它解决了Vue2中无法追踪数据新增或删除属性的问题。另外，Proxy可以直接监听数组，无需像Vue2响应式那样需要重写数组方法进行拦截</p> <p><strong>Proxy（代理）</strong>: 拦截对象中任意属性的变化, 包括：属性值的读写、属性的添加、属性的删除等。</p> <p><strong>Reflect（反射）</strong>: 对源对象的属性进行操作</p> <div class="language- extra-class"><pre class="language-text"><code>function isObject(obj) {
  if (typeof obj !== &quot;object&quot; || obj == null) {
    return false;
  } else {
    return true;
  }
}
// reactive ref
function reactive(obj) {
  if (typeof obj !== &quot;object&quot; || obj == null) {
    return obj;
  }
  //   proxy是对整个对象代理，不需要通过遍历
  let proxy = new Proxy(obj, {
    get(target, key) {//懒加载
      console.log(&quot;get&quot;, key);
      return isObject(Reflect.get(target, key)) ? reactive(Reflect.get(target, key)) : Reflect.get(target, key); //===target[key]
    },
    set(target, key, value) {
      console.log(&quot;set&quot;, key, value);
      return Reflect.set(target, key, value);
    },
    deleteProperty(target, key) {
      console.log(&quot;delete&quot;, key);
      return Reflect.deleteProperty(target, key);
    },
  });
  return proxy;
}
let obj = reactive({ name: &quot;张三&quot;, job: { code: &quot;前端&quot; } });
// obj.name=&quot;小张&quot;
// console.log(obj.name);
// obj.job.code = &quot;php&quot;;
// console.log(obj.job.code);
let arr=reactive([1,2,3,4])
arr.push(111)
console.log(arr);
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// Object.defineProperty 是对象的方法监听不到数组的变更的 Vue2.x的做法是重写数组的7个方法
// 将原型上所有的方法都拿过来
const arrayMethods = Array.prototype;
// 先克隆一份Array的原型出来
// Object.create() 是把现有对象的属性，挂到新建对象的原型上，新建对象为空对象
const arrayProto = Object.create(arrayMethods);
// 将能改变数组的七个方法，就是需要重写的方法
const methodsToPatch = [
  &quot;push&quot;,
  &quot;pop&quot;,
  &quot;shift&quot;,
  &quot;unshift&quot;,
  &quot;splice&quot;,
  &quot;sort&quot;,
  &quot;reverse&quot;,
];
methodsToPatch.forEach((method) =&gt; {
  // 给新建的对象上添加这七个方法，后面在将这个对象挂载到要实现监听的对象上，在observer中
  arrayProto[method] = function () {
    // 执行原始操作，这样在函数中不管是调用了原始数组的方法，还可以做一些其他的相关的操作
    arrayMethods[method].apply(this, arguments);
    // 监听属性
    console.log(&quot;监听赋值成功&quot;, method);
  };
});

function defineProperty(obj, key, val) {
  observer(val);
  Object.defineProperty(obj, key, {
    get() {
      // 读取方法
      console.log(&quot;读取&quot;, key, &quot;成功&quot;);
      return val;
    },
    set(newval) {
      // 赋值监听方法
      if (newval === val) return;
      // 遍历监听数据的每一项
      observer(newval);
      console.log(&quot;监听赋值成功&quot;, newval);
      val = newval;
      // 可以执行渲染操作
    },
  });
}

function observer(obj) {
  if (typeof obj !== &quot;object&quot; || obj == null) {
    return;
  }
  if (Array.isArray(obj)) {
    // 如果是数组, 重写原型
    obj.__proto__ = arrayProto;
    // 传入的数据可能是多维度的,也需要执行响应式
    for (let i = 0; i &lt; obj.length; i++) {
      observer(obj[i]);
    }
  } else {
    for (const key in obj) {
      // 给对象中的每一个方法都设置响应式
      defineProperty(obj, key, obj[key]);
    }
  }
}
let arr = [1, 2, 3, 4];
observer(obj)
observer(arr);
arr.push(111);
</code></pre></div><p>总结：</p> <ul><li>Proxy直接可以劫持整个对象，并返回一个新对象，我们可以只操作新的对象达到响应式目的</li> <li>Proxy可以直接监听数组的变化（push、shift、splice）</li> <li>Proxy有多达13种拦截方法,不限于appl、ownKeys、deleteProperty、has等等，这是Object.defineProperty不具备的。
正因defineProperty自身的缺陷，导致Vue2在实现响应式过程需要实现其他的方法辅助（如重写数组方法、增加额外set、delete方法）
但是也有不好的问题，Proxy 不兼容IE。</li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.74c4e6cc.js" defer></script><script src="/assets/js/9.de46f015.js" defer></script>
  </body>
</html>
